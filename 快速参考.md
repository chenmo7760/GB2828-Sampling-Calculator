# GB/T2828 抽样计算 - 快速参考卡

## 一、VBA函数速查

### 基础函数（推荐）

```excel
=获取样本量(批量, "检验水平", AQL值)
=获取Ac值(批量, "检验水平", AQL值)
=获取Re值(批量, "检验水平", AQL值)
=获取检验类型(批量, "检验水平", AQL值)
```

### 示例
```excel
=获取样本量(150, "Ⅱ", 1.5)     → 返回：20
=获取Ac值(150, "Ⅱ", 1.5)       → 返回：1
=获取Re值(150, "Ⅱ", 1.5)       → 返回：2
=获取检验类型(150, "Ⅱ", 1.5)   → 返回：抽检
```

## 二、参数速查

### 检验水平
| 特殊检验水平 | 一般检验水平 |
|-------------|-------------|
| S-1         | Ⅰ (或 I)    |
| S-2         | Ⅱ (或 II)   |
| S-3         | Ⅲ (或 III)  |
| S-4         |             |

### AQL值（21个标准值）
```
0.01   0.015  0.025  0.04   0.065
0.1    0.15   0.25   0.4    0.65
1.0    1.5    2.5    4.0    6.5
10     15     25     40     65     100
```

## 三、安装步骤（3步）

1. **导入代码**
   - 打开Excel → 按 `Alt + F11`
   - 插入 → 模块 → 粘贴`抽样计算.vba`代码
   
2. **保存文件**
   - 另存为 → 文件类型：`Excel 启用宏的工作簿 (*.xlsm)`
   
3. **使用函数**
   - 在单元格输入公式，如：`=获取样本量(150, "Ⅱ", 1.5)`

## 四、常见批量对应关系

| 批量范围 | 检验水平Ⅱ | 样本量字码 |
|---------|-----------|-----------|
| 2~8     | B         | A=2       |
| 9~15    | C         | B=3       |
| 16~25   | D         | C=5       |
| 26~50   | E         | D=8       |
| 51~90   | F         | E=13      |
| 91~150  | G         | F=20      |
| 151~280 | H         | G=32      |
| 281~500 | J         | H=50      |
| 501~1200| K         | J=80      |
| 1201~3200| L        | K=125     |
| 3201~10000| M       | L=200     |

## 五、典型场景示例

### 场景1：小批量产品抽检
```excel
批量：80    检验水平：Ⅱ    AQL：1.5
结果：样本量=13, Ac=1, Re=2
```

### 场景2：中批量产品抽检
```excel
批量：1000    检验水平：Ⅱ    AQL：1.5
结果：样本量=80, Ac=5, Re=6
```

### 场景3：大批量产品抽检
```excel
批量：50000    检验水平：Ⅱ    AQL：1.5
结果：样本量=315, Ac=14, Re=15
```

### 场景4：严格检验（小AQL）
```excel
批量：500    检验水平：Ⅱ    AQL：0.15
结果：样本量=50, Ac=0, Re=1
```

### 场景5：全检情况
```excel
批量：5    检验水平：Ⅱ    AQL：1.5
结果：样本量=5, 类型=全检
（当样本量≥批量时自动判定为全检）
```

## 六、公式实战

### 单个查询
在B4单元格显示样本量：
```excel
B1: 150        (批量输入)
B2: Ⅱ          (检验水平输入)
B3: 1.5        (AQL输入)
B4: =获取样本量(B1, B2, B3)
```

### 批量查询（拖动填充）
```
    A       B        C      D       E      F      G      H
1  序号   批量   检验水平  AQL   样本量   Ac    Re    类型
2   1     50      Ⅱ     1.5    公式    公式   公式   公式
3   2     500     Ⅱ     2.5    公式    公式   公式   公式
4   3     1500    Ⅲ     1.0    公式    公式   公式   公式
```

E2公式：`=获取样本量(B2,C2,D2)`
F2公式：`=获取Ac值(B2,C2,D2)`
G2公式：`=获取Re值(B2,C2,D2)`
H2公式：`=获取检验类型(B2,C2,D2)`

向下拖动填充即可。

## 七、故障排除

| 错误提示 | 原因 | 解决方案 |
|---------|------|---------|
| #NAME?  | 函数未识别 | 确认VBA代码已导入，文件已保存为.xlsm |
| #VALUE! | 参数类型错误 | 检查检验水平是否加引号，如 "Ⅱ" |
| 错误：批量超出范围 | 批量值无效 | 批量应在2~500001以上之间 |
| 错误：无效的检验水平 | 检验水平拼写错误 | 使用正确的检验水平：S-1~S-4、Ⅰ~Ⅲ |
| 错误：无效的AQL值 | AQL值不在标准列表中 | 使用21个标准AQL值之一 |

## 八、技巧提示

✓ **使用数据验证**：为检验水平和AQL值设置下拉列表，避免输入错误

✓ **条件格式**：当检验类型="全检"时，用红色背景高亮显示

✓ **命名单元格**：将常用的批量、检验水平、AQL单元格命名，公式更易读
  ```excel
  =获取样本量(批量, 检验水平, AQL)
  ```

✓ **创建模板**：将常用的查询表格保存为模板，重复使用

✓ **打印设置**：设置打印区域，只打印结果部分

## 九、高级用法

### 动态AQL选择
根据缺陷类型自动选择AQL：

```excel
=获取样本量(B1, B2, 
    IF(B5="致命", 0.01,
       IF(B5="严重", 0.4,
          IF(B5="轻微", 0.65, 1.5)
       )
    )
)
```

### 多批次统计
计算多批次总样本量：

```excel
=SUMPRODUCT(获取样本量(批量范围, 检验水平范围, AQL范围))
```

---

**版本**：1.0  
**标准**：GB/T2828.1-2003/ISO2859-1  
**日期**：2025-11-21




