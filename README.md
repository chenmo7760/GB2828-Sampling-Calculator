# GB/T 2828.1-2003 抽样标准计算工具

中文 | [English](README_EN.md)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Excel](https://img.shields.io/badge/Excel-2016%2B-217346?logo=microsoft-excel)](https://www.microsoft.com/excel)
[![Standard](https://img.shields.io/badge/标准-GB%2FT%202828.1--2003-blue)](http://www.gb688.cn/bzgk/gb/)
[![VBA](https://img.shields.io/badge/VBA-Enabled-green)](https://docs.microsoft.com/office/vba/api/overview/)

> 基于国标 GB/T 2828.1-2003 / ISO 2859-1 正常检验一次抽样方案的自动计算工具

## ✨ 特性

- 🎯 **4个Excel自定义函数** - 在任意单元格轻松使用
- 📊 **批量计算** - 支持多行数据自动计算
- 🔍 **自动判断** - 智能识别全检/抽检场景
- ✅ **完整测试** - 28个测试案例全覆盖
- 📝 **详细文档** - 完整的中文文档和示例
- 🚀 **5分钟上手** - 快速开始指南

## 📁 项目文件清单

```
.
├── 抽样标准GB2828.xlsm       # Excel工作簿（含VBA宏）
├── 抽样标准GB2828.xlsx       # Excel工作簿（无宏版本）
├── 抽样计算.vba              # VBA源代码（主文件）
├── 抽样计算_改进版.vba        # VBA源代码（改进版）
├── 工作表事件代码.vba         # 工作表事件处理代码
├── README.md                # 项目说明（中文）
├── README_EN.md             # 项目说明（英文）
├── 快速参考.md               # 快速参考卡片
├── 更新说明_v1.1.md          # 版本更新说明
├── re.md                    # 原始需求文档
├── LICENSE                  # MIT开源协议
└── .gitignore              # Git忽略配置
```

## 🚀 5分钟快速开始

### 第一步：准备Excel文件
1. 打开 `抽样标准GB2828.csv`
2. 另存为 Excel 格式：`抽样标准GB2828.xlsm`（启用宏的工作簿）

### 第二步：导入VBA代码
1. 在Excel中按 `Alt + F11` 打开VBA编辑器
2. 菜单：插入 → 模块
3. 打开 `抽样计算.vba`，复制全部代码粘贴到模块窗口
4. 关闭VBA编辑器（按 `Alt + Q`）

### 第三步：使用函数
在任意单元格输入公式：
```excel
=获取样本量(150, "Ⅱ", 1.5)
```
回车，即可看到结果：`20`

✅ 完成！现在您可以使用所有功能了。

## 📚 核心功能

### VBA自定义函数（4个）

| 函数名 | 说明 | 示例 | 返回值 |
|--------|------|------|--------|
| `获取样本量()` | 计算抽样样本量 | `=获取样本量(150,"Ⅱ",1.5)` | 20 |
| `获取Ac值()` | 获取接收数 | `=获取Ac值(150,"Ⅱ",1.5)` | 1 |
| `获取Re值()` | 获取拒收数 | `=获取Re值(150,"Ⅱ",1.5)` | 2 |
| `获取检验类型()` | 判断全检/抽检 | `=获取检验类型(150,"Ⅱ",1.5)` | 抽检 |

### 完整计算函数

```excel
=计算抽样(150, "Ⅱ", 1.5)
```
返回数组：`{样本量, Ac值, Re值, 检验类型}`

## 📖 参数说明

### 批量 (PL)
- **类型**：整数
- **范围**：2 ~ 500000以上
- **示例**：`150`, `5000`, `100000`

### 检验水平
- **特殊水平**：`"S-1"`, `"S-2"`, `"S-3"`, `"S-4"`
- **一般水平**：`"Ⅰ"`, `"Ⅱ"`, `"Ⅲ"` （也可写为 `"I"`, `"II"`, `"III"`）
- **注意**：必须用双引号包围

### AQL值（接收质量限）
可选值（21个标准值）：
```
0.01, 0.015, 0.025, 0.04, 0.065,
0.1,  0.15,  0.25,  0.4,  0.65,
1.0,  1.5,   2.5,   4.0,  6.5,
10,   15,    25,    40,   65,    100
```

## 💡 使用示例

### 示例1：单个计算
```excel
A1: 批量          B1: 150
A2: 检验水平      B2: Ⅱ
A3: AQL          B3: 1.5
A4: 样本量        B4: =获取样本量(B1, B2, B3)
A5: 接收数(Ac)    B5: =获取Ac值(B1, B2, B3)
A6: 拒收数(Re)    B6: =获取Re值(B1, B2, B3)
```

### 示例2：批量处理
创建表格，自动计算多个样品：

|序号|批量|检验水平|AQL|样本量|Ac|Re|
|----|----|----|----|----|----|----|
|1|50|Ⅱ|1.5|=获取样本量(B2,C2,D2)|=获取Ac值(B2,C2,D2)|=获取Re值(B2,C2,D2)|
|2|500|Ⅱ|2.5|=获取样本量(B3,C3,D3)|=获取Ac值(B3,C3,D3)|=获取Re值(B3,C3,D3)|
|3|1500|Ⅲ|1.0|=获取样本量(B4,C4,D4)|=获取Ac值(B4,C4,D4)|=获取Re值(B4,C4,D4)|

向下拖动填充公式即可批量计算。

### 示例3：条件判断
根据缺陷类型自动选择AQL：
```excel
=获取样本量(B1, B2, IF(B3="致命", 0.01, IF(B3="严重", 0.4, 0.65)))
```

## 🧪 测试验证

### 运行自动化测试
1. 在VBA编辑器中，插入 → 模块
2. 复制 `测试验证.vba` 的全部代码粘贴进去
3. 按 `F5` 运行 `运行所有测试` 过程
4. 查看测试报告，确认所有测试通过

### 测试覆盖
- ✓ 基本功能测试（5个案例）
- ✓ 边界值测试（4个案例）
- ✓ 不同检验水平测试（7个案例）
- ✓ 不同AQL值测试（6个案例）
- ✓ 全检情况测试（3个案例）
- ✓ 大批量测试（3个案例）

**总计：28个测试案例**

## 📋 典型应用场景

### 场景1：产品出厂检验
```
批量：500件
检验水平：Ⅱ（一般检验）
AQL：1.5（允许少量不合格）
→ 样本量：50件，Ac=2，Re=3
```

### 场景2：关键零部件检验
```
批量：1000件
检验水平：Ⅲ（较严格）
AQL：0.4（严格要求）
→ 样本量：80件，Ac=2，Re=3
```

### 场景3：小批量检验
```
批量：10件
检验水平：Ⅱ
AQL：1.5
→ 样本量：10件，全检
```

## ⚙️ 高级设置

### 1. 创建下拉列表
选中单元格 → 数据 → 数据验证 → 序列

**检验水平下拉：**
```
S-1,S-2,S-3,S-4,Ⅰ,Ⅱ,Ⅲ
```

**AQL值下拉：**
```
0.01,0.015,0.025,0.04,0.065,0.1,0.15,0.25,0.4,0.65,1.0,1.5,2.5,4.0,6.5,10,15,25,40,65,100
```

### 2. 条件格式
当检验类型="全检"时高亮显示：

- 选中结果单元格
- 开始 → 条件格式 → 新建规则
- 使用公式：`=H2="全检"`
- 设置格式：红色背景

### 3. 打印设置
只打印计算结果区域：

- 页面布局 → 打印区域 → 设置打印区域
- 选择包含输入和输出的区域

## ❓ 常见问题

### Q1：显示 #NAME? 错误
**原因**：VBA函数未加载

**解决**：
1. 确认VBA代码已正确导入
2. 文件已保存为 `.xlsm` 格式
3. 检查宏安全设置（文件→选项→信任中心→宏设置）

### Q2：显示 #VALUE! 错误
**原因**：参数类型错误

**解决**：
- 检验水平必须用引号：`"Ⅱ"` 而不是 `Ⅱ`
- 批量必须是数字
- AQL值必须是标准值之一

### Q3：如何输入罗马数字？
**方法1**：使用英文字母
- `"I"` 代替 `"Ⅰ"`
- `"II"` 代替 `"Ⅱ"`
- `"III"` 代替 `"Ⅲ"`

**方法2**：使用输入法
- 搜狗拼音：输入 `v1`, `v2`, `v3`
- 使用下拉列表（推荐）

### Q4：样本量大于批量怎么办？
**答**：当样本量≥批量时，自动判定为"全检"，需要对整批产品进行100%检验。

### Q5：计算结果准确吗？
**答**：代码完全按照GB/T2828.1-2003标准实现，包含：
- 样本量字码查找
- "上"、"下"箭头自动追踪
- 边界条件处理

已通过28个测试案例验证。

## 📄 技术文档

### 算法流程
```
1. 根据批量→查找批量区间行(H1)
2. 根据检验水平→查找检验水平列(L1)
3. 交叉点→获取样本量字码(ZM)
4. 在K列查找字码→确定字码行(H2)
5. 根据AQL→计算AC/RE列号
6. 读取H2行与AC/RE列交叉的值
   - 数字→直接使用
   - "上"→向上查找直到数字
   - "下"→向下查找直到数字
7. 判断：样本量≥批量→全检，否则抽检
```

### 列号对照
| Excel列 | 内容 | 列号 |
|---------|------|------|
| A-B | 批量范围 | 1-2 |
| D-G | 特殊水平 S-1~S-4 | 4-7 |
| H-J | 一般水平 Ⅰ~Ⅲ | 8-10 |
| K | 样本量字码 | 11 |
| L | 样本量 | 12 |
| O-P | AQL=0.01 | 15-16 |
| Q-R | AQL=0.015 | 17-18 |
| ... | ... | ... |

## 🔗 相关标准

- **GB/T 2828.1-2003**：计数抽样检验程序 第1部分：按接收质量限（AQL）检索的逐批检验抽样计划
- **ISO 2859-1**：Sampling procedures for inspection by attributes -- Part 1: Sampling schemes indexed by acceptance quality limit (AQL) for lot-by-lot inspection

## 📝 更新日志

### v1.0 (2025-11-21)
- ✅ 实现核心计算功能
- ✅ 支持4个自定义函数
- ✅ 处理"上"、"下"箭头逻辑
- ✅ 支持全检判断
- ✅ 完整的测试套件（28个案例）
- ✅ 详细的使用文档

## 📄 使用许可

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

## 🤝 贡献指南

欢迎提交问题（Issues）和功能请求（Feature Requests）！

如果你想贡献代码：
1. Fork 本项目
2. 创建你的特性分支 (`git checkout -b feature/AmazingFeature`)
3. 提交你的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 开启一个 Pull Request

## 📧 技术支持

遇到问题？请提供：
1. Excel版本
2. 输入参数（批量、检验水平、AQL）
3. 预期结果 vs 实际结果
4. 错误截图

可以通过以下方式寻求帮助：
- 📝 提交 [Issue](../../issues)
- 💬 发起 [Discussion](../../discussions)

## ⭐ 支持项目

如果这个工具对你有帮助，请给个 Star ⭐️ 支持一下！

## 🙏 致谢

- 基于国家标准 GB/T 2828.1-2003 开发
- 感谢所有贡献者和使用者的反馈

---

**版本**：v1.1  
**创建日期**：2025-11-21  
**更新日期**：2025-11-22  
**适用标准**：GB/T 2828.1-2003 / ISO 2859-1  
**检验类型**：正常检验一次抽样




